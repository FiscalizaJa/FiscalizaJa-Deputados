---
import BaseLayout from "../../layouts/BaseLayout.astro";
import DeputadoHeader from "../../components/DeputadoHeader"
import DeputadoBody from "../../components/DeputadoBody";
import "../../styles/deputado.scss";

const { id } = Astro.params

const baseURL = import.meta.env.PUBLIC_API_URL

const date = new Date()

const request_promises = [
    fetch(`${baseURL}/deputados/${id}`),
]

const serialize_promises = []

const requests = await Promise.all(request_promises)

for(const request of requests) {
    serialize_promises.push(request.json())
}

const data = await Promise.all(serialize_promises)

const deputado = data[0].data

deputado.dataNascimento = new Date(deputado.dataNascimento)
deputado.nomeCivil = deputado.nomeCivil.split(" ").map(nome => nome.charAt(0) + nome.slice(1).toLowerCase()).join(" ")

const og_url = `https://www.camara.leg.br/internet/deputado/bandep/pagina_do_deputado/${deputado.idCamara}.jpg`

export const prerender = false
---

<BaseLayout title={`${deputado.siglaSexo === "M" ? "Deputado" : "Deputada"} Federal ${deputado.nome} | FiscalizaJá Deputados`} description={`Despesas ${deputado.siglaSexo === "m" ? "do deputado" : "da deputada"} ${deputado.nome} com a cota parlamentar | FiscalizaJá Deputados`} og_img={og_url}>
    <DeputadoHeader deputado={deputado} />
    <DeputadoBody deputado={deputado} baseURL={import.meta.env.PUBLIC_API_URL} client:load/>
</BaseLayout>